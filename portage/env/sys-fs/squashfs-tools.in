# Copyright (c)
#  Martin VÃ¤th <martin@mvath.de>

post_src_unpack () {
	local s
	einfo "@PACKAGE@'s hack: ${PORTAGE_CONFIGROOT%/}/etc/portage/env/${CATEGORY}/${PN}"
	(	for i in \
"@DOCDIR@/squashfs-tools-patch/${P}-progress-stderr.patch"*
do	test -r "${i}" || continue
	cd -- "${S}" >/dev/null 2>&1 && \
	@DECOMPRESS@ "${i}" | \
		patch -p1 --force --no-backup-if-mismatch >/dev/null \
		|| exit 1
	exit 0
done
exit 1
	)
	s=${?}
	if [ ${s} -eq 0 ]
	then	einfo "@PACKAGE@'s hack: patch successfully applied"
	elif [ ${s} -eq 2 ]
	then	ewarn "@PACKAGE@'s hack: No patch prepared for ${P} was found."
		ewarn "You might want to update or remove the file"
		ewarn "${PORTAGE_CONFIGROOT%/}@SYSCONFDIR@/portage/env/${CATEGORY}/${PN}"
	else	eerror "@PACKAGE@'s hack: Patching for ${P} failed."
		eerror "This error was triggered by the hack in the file"
		eerror "${PORTAGE_CONFIGROOT%/}@SYSCONFDIR@/portage/env/${CATEGORY}/${PN}"
		die "If you remove the above file you can emerge ${CATEGORY}/${PN} normally."
	fi
}
